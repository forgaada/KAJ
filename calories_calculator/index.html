<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulačka kalorií</title>

    <style>
        body {
            margin: 0;
            font-family: "Bookman Old Style", "S", serif;
            background-color: #f0faf7;
        }

        .page {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .page header {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100px;
            background: #348022;
            color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }
        .page section {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            flex-grow: 1;
            min-height: 400px;
        }

        /** NAVIGATION SECTION **/

        .page section nav {
            display: flex;
            flex-direction: column;
            padding: 0.5em;
            margin: 0;
            white-space: nowrap;
        }

        #menu ul {
            margin: 0;
            padding: 0;
        }

        #menu ul li {
            list-style: none;
        }

        #menu ul li a {
            width: auto;
            text-decoration: none;
            color: white;
            display: block;
            align-content: center;
            text-align: center;
            padding: 20px 30px;
            margin: 5px;
            background-color: #2fd015;
            -webkit-transition: all 0.5s ease;
            -moz-transition: all 0.5s ease;
            -ms-transition: all 0.5s ease;
            -o-transition: all 0.5s ease;
            transition: all 0.5s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }
        #menu ul li a:visited { text-decoration: none;}
        #menu ul li a:hover { text-decoration: none;}
        #menu ul li a:focus { text-decoration: none;}

        #menu ul li a:hover {
            background: #348022;
            transform: translateX(+5%);
        }

        #menu-control-input {
            display: none;
        }
        #menu-control {
            display: none;
        }

        .page section nav .user-box {
            display: flex;
            width: 165px;
            margin: 5px;
            justify-content: center;
            align-content: start;
            flex-direction: column;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            background-color: #e6f0ed;
        }

        .page section nav .user-box img{
            align-self: center;
            border-radius: 50%;
        }

        .page section nav .user-box h4{
            margin-top: 0;
            background-color: #348022;
            padding-top: 1em;
            height: 40px;
            color: white;
            display: flex;
            justify-content: center;
            align-content: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }

        .page section nav .user-box p{
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 75ch;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            background-color: white;
        }

        /** ARTICLE SECTION **/

        .page section article {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            flex-grow: 1;
            flex-direction: column;
            padding: 1em;
        }

        .page section article .content-box {
            align-self: center;
            flex-wrap: nowrap;
            width: 400px;
            display: flex;
            justify-content: center;
            align-content: start;
            flex-direction: column;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            background-color: #e6f0ed;
            margin-bottom: 50px;
        }

        .page section article .content-box h4{
            margin-top: 0;
            background-color: #348022;
            padding-top: 1em;
            height: 40px;
            color: white;
            display: flex;
            justify-content: center;
            align-content: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }

        .page section article .content-box p{
            display: flex;
            justify-content: flex-start;
            flex-direction: column;
        }

        .page section article .content-box label{
            margin: 5px;
        }

        .page section article .content-box p input {
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            margin: 5px;
            height: 25px;
            width: 75%;
        }

        .page section article .content-box p input:nth-of-type(odd){
            background-image: linear-gradient(to left, rgba(124, 255, 68, 0.31), white, white, white);
        }

        .page section article .content-box p input:nth-of-type(even){
            background-image: linear-gradient(to left, rgba(14, 140, 0, 0.2), white, white, white);
        }

        .page section article .content-box .content-button {
            align-self: center;
            height: 50px;
            width: 75px;
            color: white;
            background-color: #2fd015;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            -webkit-transition: background-color 0.5s;
            -moz-transition: background-color 0.5s;
            -ms-transition: background-color 0.5s;
            -o-transition: background-color 0.5s;
            transition: background-color 0.5s;
            border: 0;
            font-family: "Bookman Old Style", "S", serif;
            font-size: 14px;
            margin: 1em;
        }

        .page section article .content-box .content-button:hover {
            background-color: #348022;
        }

        .page section article .label-content {
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            background-color: white;
            margin: 5px;
            padding: 5px;
        }

        .page section article .content-box .content-scrollable {
            max-height: 300px;
            overflow: auto;
            text-align:justify;
        }

        .page section article .content_inline {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
        }

        .page section article .home-boxes {
            display: none;
        }

        .page section article .state-boxes {
            display: none;
        }

        .page section article .meals-boxes {
            display: none;
        }

        .page section article #page-logo {
            align-self: center;
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: transparent;
            margin: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }

        .page section article .meals-boxes img {
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            align-self: center;
            padding: 5px;
            background-color: white;
        }

        .page section article .settings-boxes {
            display: none;
        }

        .page section #pie-chart {
            display: none;
            width: 200px;
            height: 200px;
            align-self: center;
            border-radius: 50%;
        }

        /** ASIDE SECTION **/

        .page section aside {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            flex-direction: column;
            background-color: #2fd015;
            width: 150px;
            margin: 1em;
            box-sizing: border-box;
            -webkit-transition: all 0.5s ease-in;
            -moz-transition: all 0.5s ease-in;
            -ms-transition: all 0.5s ease-in;
            -o-transition: all 0.5s ease-in;
            transition: all 0.5s ease-in;
            color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }

        .page section aside h4{
            margin-top: 150px;
            width: 200px;
            font-size: 25px;
            transform: rotate(90deg);
            -webkit-transition: all 0.5s ease-in;
            -moz-transition: all 0.5s ease-in;
            -ms-transition: all 0.5s ease-in;
            -o-transition: all 0.5s ease-in;
            transition: all 0.5s ease-in;
        }

        .page section aside p {
            width: 200px;
            display: none;
        }

        .page section aside img {
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            width: 200px;
            display: none;
        }

        .page section aside:hover {
            width: 250px;
        }

        .page section aside:hover h4{
            transform: rotate(0deg);
            margin-top: 10px;
        }

        .page section aside:hover p {
            display: flex;
            margin: 10px 10px;
            font-size: 16px;
        }

        .page section aside:hover img {
            display: flex;
            margin: 10px 10px;
            border-radius: 15px;
        }

        /** FOOTER **/

        .page footer {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 50px;
            background: #348022;
            color: white;
        }

        /** ERROR INPUTS **/
        .error {
            border-color: red;
            border-width: 3px;
        }

        /** FOCUSED INPUTS **/

        input[type=text], input[type=number], textarea {
            -webkit-transition: all 0.30s ease-in-out;
            -moz-transition: all 0.30s ease-in-out;
            -ms-transition: all 0.30s ease-in-out;
            -o-transition: all 0.30s ease-in-out;
            transition: all 0.30s ease-in-out;
            outline: none;
        }

        input[type=text]:focus, input[type=number]:focus, textarea:focus {
            box-shadow: 0 0 5px rgb(47, 208, 21);
            border: 2px solid rgb(7, 230, 18);
        }

        /** Media Queries - MOBILE SECTION **/

        @media only screen and (max-width: 768px) {
            .page section {
                flex-direction: column;
            }

            .page section article .content-box {
                flex-grow: 1;
                width: 100%;
            }

            .page section article .content-box p input  {
                width: auto;
            }

            .page section nav {
                order: 0;
                padding: 0;
            }

            .page section nav .user-box {
                display: none;
            }

            .page section main {
                order: 1;
            }
            .page section aside {
                display: none;
            }
            #menu {
                display: inline;
            }
            .main_menu {
                display: none;
            }
            #menu ul li a{
                margin: 0 ;
             }

            #menu ul li a:hover {
                transform: none;
            }

            #menu-control {
                width: 100%;
                display: flex;
                align-content: center;
                justify-content: center;
                visibility: visible;
                color: white;
                background-color:#348022;
                padding-top: 20px;
                padding-bottom: 20px;

                -webkit-transition: background-color  0.5s;
                -moz-transition: background-color  0.5s;
                -ms-transition: background-color  0.5s;
                -o-transition: background-color  0.5s;
                transition: background-color 0.5s;
            }

            #menu-control:hover {
                background-color: #2fd015;
            }

            #menu-control-input:checked + .main_menu {
                display: inline;
            }
        }

    </style>
</head>
<body>
<div class="page">
    <header>
        <h1>Kalkulačka kalorií</h1>
    </header>
    <section>
        <nav id="menu">
            <label id="menu-control" for="menu-control-input">Menu</label><input type="checkbox" id="menu-control-input" />
            <ul class="main_menu">
                <li><a href="#home">Domů</a></li>
                <li><a href="#state">Denní příjem</a></li>
                <li><a href="#meals">Potraviny</a></li>
                <li><a href="#settings">Nastavení</a></li>
            </ul>
            <div class="user-box">
                <h4>Uživatel</h4>
                <img src="pictures/user.jpg" alt="user-image" width="100" height="100">
                <p id="user-name">Neznámý</p>
            </div>
        </nav>
        <article id= "main">
            <h2 id="article-heading">Kalkulátor denního kalorického příjmu</h2>
            <p id="article-content"></p>
            <img id="page-logo" src="pictures/logo.png" alt="food">
            <div class="content-box state-boxes">
                <h4>Denní stav</h4>
                <p>Stav naplnění denního příjmu kalorií</p>
                <svg id="pie-chart" viewBox="0 0 200 200"></svg>

                <label class="label-content" id="income">Dnešní příjem činí:</label>
                <label class="label-content" id="basal">Váš cílový kalorický příjem: [kcal].</label>
                <button class="content-button" id="state_button">Vymazat Data</button>
            </div>
            <div class="content-box meals-boxes">
                <h4>Hledej jídlo online</h4>
                <img src="pictures/nutritionix.jpg" alt="nutritionix-image" width="286" height="74">
                <p>
                    <label>Najdi jídlo včetně nutričních hodnot na serveru Nutritionix (hledat je možné pouze v anglickém jazyce).</label>
                    <label for="find-meal-input">Název jídla: </label><input type="text" id="find-meal-input" placeholder="Nachos">
                    <button class="content-button" id="find-meal-button">Hledej</button>
                </p>
                <p id="find-meal-content-all" class="content-scrollable">Výsledky hledání: </p>
            </div>

            <div class="content-box settings-boxes">
                <h4>Výpočet denního kalorického výdeje</h4>
                <p>
                    <label for="name-input">Vaše jméno: </label><input type="text" id="name-input" placeholder="Pišta">
                    <label for="weight-input">Vaše tělesná hmotnost v [kg]: </label><input type="number" id="weight-input" placeholder="Hmotnost">
                    <label for="height-input">Vaše výška v [cm]: </label><input type="number" id="height-input" placeholder="Výška">
                    <label for="age-input">Váš věk: </label><input type="number" id="age-input" placeholder="Věk">
                </p>
                <p> Pohlaví:</p>
                <div class="content_inline">
                    <label>
                        <input class="sex" type="radio" id="sex_male" name="sex" value="male" checked> Muž
                    </label>
                    <label>
                        <input class="sex" type="radio" id="sex_female" name="sex" value="female"> Žena
                    </label>
                </div>
                <p> Aktivita: </p>
                    <label>
                        <input class="activity" type="radio" id="activity_1" name="activity" value="1.2" checked> Sedavé zaměst. + žádný trénink
                    </label>
                    <label>
                        <input class="activity" type="radio" id="activity_2" name="activity" value="1.4" checked> Sedavé zaměst. + trénink vyšší intenzity
                    </label>
                    <label>
                        <input class="activity" type="radio" id="activity_3" name="activity" value="1.6" checked> Sedavé zaměst. + trénink 3x- 4x týdně
                    </label>
                    <label>
                        <input class="activity" type="radio" id="activity_4" name="activity" value="1.8" checked> Sedavé zaměst. + trénink 6x týdně
                    </label>
                    <label>
                        <input class="activity" type="radio" id="activity_5" name="activity" value="2.0" checked> Manuální těžké zaměst. + trénink 3x – 4x týdně
                    </label>
                    <label>
                        <input class="activity" type="radio" id="activity_6" name="activity" value="2.2" checked> Manuální těžké zaměst. + trénink 6x týdně
                    </label>
                <p> Cíl: </p>
                <div class="content_inline">
                    <label>
                        <input class="goal" type="radio" id="goal_1" name="goal" value="0.8" checked> Hubnutí
                    </label>
                    <label>
                        <input class="goal" type="radio" id="goal_2" name="goal" value="1"> Udržování
                    </label>
                    <label>
                        <input class="goal" type="radio" id="goal_3" name="goal" value="1.2"> Nabírání
                    </label>
                </div>
                <button class="content-button" id="basal_button">Vypočítat</button>
            </div>
            <div class="content-box home-boxes">
                <h4> Dnes jsem snědl ... </h4>
                <p>
                    <label for="meal-name-input">Název jídla: </label><input type="text" id="meal-name-input" placeholder="Zde zadejte název jídla">
                    <label for="meal-calories-input">Počet kalorií na 100g/ml [kcal]: </label><input type="text" id="meal-calories-input" placeholder="Zde zadejte počet kalorií">
                    <label for="meal-protein-input">Počet bílkovin na 100g/ml [g]: </label><input type="text" id="meal-protein-input" placeholder="Zde zadejte počet [g] bílkovin">
                    <label for="meal-fat-input">Počet tuků na 100g/ml [g]: </label><input type="text" id="meal-fat-input" placeholder="Zde zadejte počet [g] tuku">
                    <label for="meal-sugars-input">Počet sacharidů na 100g/ml [g]: </label><input type="text" id="meal-sugars-input" placeholder="Zde zadejte počet [g] kalorií">
                    <label for="meal-weight-input">Množství [g/ml]: </label><input type="text" id="meal-weight-input" placeholder="Zde zadejte množství">
                    <button class="content-button" id="meal_button">Zapsat</button>
                </p>

            </div>
            <div class="content-box state-boxes">
                <h4>Dnešní pokrmy</h4>
                <p id="today-meals-all" class="content-scrollable"> Přehled dnešních porkmů: </p>
            </div>
        </article>
        <aside>
            <h4>Věděli jste, že?</h4>
            <p>Bazální rychlost metabolismu (BMR) je měření energetického výdeje organismu v klidu.</p>
            <p> Určuje kolik kalorií potřebujete denně přijmout, abyste si udrželi hmotnost nebo ji naopak snížili.</p>
            <p> Jde o počet kalorií, které tělo potřebuje pro správný chod základních životních funkcí.</p>
            <img src="pictures/bmr.jpg" alt="bmr-schema">
        </aside>
    </section>
    <footer>
        Created by Adam Forgáč | 2020 | CTU FEL Prague
    </footer>
</div>
<script>
    // Initialize document buttons
    const meal_button = document.getElementById("meal_button");
    const basal_button = document.getElementById("basal_button");
    const state_button = document.getElementById("state_button");
    const find_meal_button = document.getElementById("find-meal-button");

    // Initialize images
    let pageLogoImg = document.getElementById("page-logo");
    let homePageImg = new Image();
    homePageImg.onload = function () {
        pageLogoImg.src = this.src;
    };
    let statePageImg = new Image();
    statePageImg.onload = function () {
        pageLogoImg.src = this.src;
    };
    let mealsPageImg = new Image();
    mealsPageImg.onload = function () {
        pageLogoImg.src = this.src;
    };
    let settingsPageImg = new Image();
    settingsPageImg.onload = function () {
        pageLogoImg.src = this.src;
    };

    // Initialize global variables
    let stats = null;
    let pieChart = null;
    let meals = [];

    // Initialize today's Date
    let todayDate = new Date();
    let today;

    // Set window.onload function
    window.onload = load;

    /*
        Sets today variable to today's date in 'mm/dd/yyyy' format. Loads stats and meals variables.
        Adds eventListener to popstate event for changing page and loads home page.
     */
    function load() {
        let dd = String(todayDate.getDate()).padStart(2, '0');
        let mm = String(todayDate.getMonth() + 1).padStart(2, '0');
        let yyyy = todayDate.getFullYear();
        today = mm + '/' + dd + '/' + yyyy;

        loadHomePage();
        document.title = "Domů";
        stats = new Stats();
        stats.updateUserInfo();
        window.addEventListener('popstate', () => {
            this.setPageRoute(window.location.hash);
        });
        loadMeals();
    }

    // Changes page title and loads current page according to given hash.
    function setPageRoute(hash) {
        document.getElementById("menu-control-input").checked = false;
        switch (hash) {
            case "#home": {
                document.title = "Domů";
                loadHomePage();
                break;
            }
            case "#state": {
                loadStatePage();
                document.title = "Denní příjem";
                break;
            }
            case "#meals": {
                loadMealsPage();
                document.title = "Potraviny";
                break;
            }
            case "#settings": {
                loadSettingsPage();
                document.title = "Nastavení";
                break;
            }
            default :
                document.title = "Domů";
                loadHomePage();
                break;
        }
    }

    // Loads home page and updates page content accordingly.
    function loadHomePage() {
        clearContentBoxes();
        loadContentBoxes("home-boxes");
        updateArticle("Kalkulátor denního kalorického příjmu",
            "Poznač si, co jsi měl dnes k jídlu. Pro hledání potravin online přejdi na 'Potraviny'. Pro zjištění výdeje " +
            "přejdi do 'Nastavení'");
        homePageImg.src = "pictures/fruit.jpg";
    }

    // Loads state page with user stats and updates content accordingly.
    function loadStatePage() {
        clearContentBoxes();
        loadStateData();
        loadContentBoxes("state-boxes");
        updateArticle("Přehled denního příjmu",
            "Zde nalezneš svůj denní kalorický příjem včetně zapsaných jídel. Pro odstranění všech svých záznamů stiskni 'Vymazat data'.");
        statePageImg.src = "pictures/pears.jpg";
    }

    // Loads meals page for searching meals and updates content accordingly.
    function loadMealsPage() {
        clearContentBoxes();
        loadContentBoxes("meals-boxes");
        updateArticle("Potraviny",
            "V této sekci můžeš hledat nutriční hodnoty potravin online. Vyhledávač je v anglickém jazyce.");
        mealsPageImg.src = "pictures/jahody.jpg";
    }

    // Loads settings page and updates content accordingly.
    function loadSettingsPage() {
        clearContentBoxes();
        loadContentBoxes("settings-boxes");
        updateArticle("Nastavení kalorického výdeje",
            "Vyplň tabulku pro výpočet bazálního metabolismu a denního kalorického výdeje a zjisti tak svůj doporučený denní kalorický příjem.");
        settingsPageImg.src = "pictures/breakfast.jpg";
    }


    // Hides all elements with '.content-box' class from page.
    function clearContentBoxes() {
        for (let element of document.getElementsByClassName("content-box")) {
            element.style.display = "none";
        }
    }

    // Displays all elements with given className on page.
    function loadContentBoxes(className) {
        for (let element of document.getElementsByClassName(className)) {
            element.style.display = "flex";
        }
    }

    // Updates page article content and heading.
    function updateArticle(heading, content) {
        document.getElementById("article-heading").innerText = heading;
        document.getElementById("article-content").innerText = content;
    }

    /*
       Loads state page elements. Dumps user's income and basal values and all today's meals.
       Based on income / outcome (basal) ratio creates SVGPieChart of today's income percentage.
    */
    function loadStateData() {
        todayDate = new Date();
        document.getElementById("pie-chart").style.display = "initial";
        if (pieChart === null) {
            pieChart = new SVGPieChart("#pie-chart");
        } else {
            pieChart.clear();
        }
        let percentage = stats._calories/stats.basal*100;

        pieChart.drawChart(100,"grey",false);
        if (percentage < 50) {
            pieChart.drawChart(percentage,"lime",true);
        } else if (percentage< 75 ){
            pieChart.drawChart(percentage,"orange",true);
        } else {
            pieChart.drawChart(percentage,"red",true);
        }

        document.getElementById("income").innerText = "Dnešní příjem činí " + '\r' +
            stats._calories.toFixed(0) + " [kcal]" + '\r' +
            stats._protein_income.toFixed(0) + " g bílkovin" + '\r' +
            stats._fat_income.toFixed(0) + " g tuků" + '\r' +
            stats._sugars_income.toFixed(0) + "g sacharidů";

        document.getElementById("basal").innerText = "Váš cílový kalorcký příjem:  "+ stats.basal.toFixed(0) + " [kcal].";

        // Load all eaten meals.
        loadMeals();

        // Render only today's meals.
        renderTodayMeals(today);
    }

    // Renders all meals eaten on the specific day and creates buttons for browsing also the previous days meals.
    function renderTodayMeals(day) {
        document.querySelector("#today-meals-all").innerHTML = "Přehled pokrmů ("+day+") : ";
        let createdDiv = document.createElement("div");
        createdDiv.classList.add("content_inline");

        let createdButtonLastDay = document.createElement("button");
        createdButtonLastDay.classList.add("content-button");
        createdButtonLastDay.innerText = "Předešlý den";
        createdButtonLastDay.addEventListener("click", () => {
            let d = todayDate;
            d.setDate(d.getDate() - 1);
            let dd = String(d.getDate()).padStart(2, '0');
            let mm = String(d.getMonth() + 1).padStart(2, '0');
            let yyyy = d.getFullYear();
            d = mm + '/' + dd + '/' + yyyy;
            renderTodayMeals(d);
        });

        let createdButtonNextDay = document.createElement("button");
        createdButtonNextDay.classList.add("content-button");
        createdButtonNextDay.innerText = "Příští den";
        createdButtonNextDay.addEventListener("click", () => {
            let d = todayDate;
            d.setDate(d.getDate() + 1);
            let dd = String(d.getDate()).padStart(2, '0');
            let mm = String(d.getMonth() + 1).padStart(2, '0');
            let yyyy = d.getFullYear();
            d = mm + '/' + dd + '/' + yyyy;
            renderTodayMeals(d);
        });

        createdDiv.appendChild(createdButtonLastDay);
        createdDiv.appendChild(createdButtonNextDay);
        document.querySelector("#today-meals-all").appendChild(createdDiv);

        // Render all meals by specific day.
        for (let meal of meals) {
            if (meal._date === day) {
                renderMeal(meal , day);
            }
        }
    }

    // Loads meals variable from localStorage and parses it into global variable 'meals' via JSON.
    function loadMeals() {
        if (localStorage.getItem("meals") !== null) {
            meals = [];
            let mealsJson = JSON.parse(localStorage.getItem("meals"));
            for (let meal of mealsJson) {
                let newMeal = new Meal(meal._name,meal._calories,meal._protein,meal._fat,meal._sugars,meal._weight);
                newMeal.setDate(meal._date);
                newMeal.setId(meal._id);
                newMeal.pushMeal();
            }
        } else {
            meals = [];
        }
    }

    // Updates meals variable in localStorage with global 'meals' variable and uses stringify method to make it JSON object.
    function updateMeals() {
        localStorage.setItem("meals",JSON.stringify(meals));
    }
    /*
        Renders meal's values into a new element but only for meal eaten today
        (means with '_today' variable matching with global today variable).
    */
    function renderMeal (meal, day) {
        let createdElement = document.createElement("label");
        createdElement.classList.add("label-content");
        createdElement.innerText = meal._name + " \r S hodnotami na 100g: Kalorie: "
            + meal._calories +" [kcal] - Bílkoviny "+meal._protein+" g - Tuky: "+meal._fat+ " g - Sacharidy: "
            + meal._sugars+ " g. V množství "+ meal._weight +" g." + '\r \r ';

        if (day === today) {
            let createdButton = document.createElement("button");
            createdElement.appendChild(createdButton);
            createdButton.classList.add("content-button");
            createdButton.innerText = "Smazat";
            createdElement.style.pointerEvents = "none";
            createdButton.style.pointerEvents = "auto";
                // Adds eventListener for delete button "click" event.
                // Removes meal element and subtracts nutrition values from stats.
            createdButton.addEventListener("click", function () {
                for( let i = 0; i < meals.length; i++) {
                    if ( meals[i]._id === this._id) {
                        meals.splice(i, 1); i--;
                        document.querySelector("#today-meals-all").removeChild(createdElement);
                        stats._calories -= meal._calories * meal._weight / 100;
                        if (stats._calories<0) {stats._calories = 0}
                        stats._fat_income -= meal._fat * meal._weight / 100;
                        if (stats._fat_income <0) {stats._fat_income = 0}
                        stats._sugars_income -= meal._sugars * meal._weight / 100;
                        if (stats._sugars_income<0) {stats._sugars_income = 0}
                        stats._protein_income -= meal._protein * meal._weight / 100;
                        if (stats._protein_income<0) {stats._protein_income = 0}
                        stats.saveStats();
                        stats.updateUserInfo();
                        updateMeals();
                        loadStateData();
                    }
                }
            }.bind(meal))
        }
        document.querySelector("#today-meals-all").appendChild(createdElement);
    }

    /*
        Represents parent class for Meal and Stats classes.
     */
    class AbstractEntity {
        constructor(name) {
            this._id = this.getId();
            this._name = name;
        }

        // Creates unique id string.
        getId () {
            return '_' + Math.random().toString(36).substr(2, 9);
        }
    }

    /*
        Represents class containing all nutritional values of meal entity and also '_id' and '_name' variables
        from it's parent class.
     */
    class Meal extends AbstractEntity {
        constructor(name, calories, protein, fat, sugars, weight) {
            super(name);
            this._calories = calories;
            this._protein = protein;
            this._fat = fat;
            this._sugars = sugars;
            this._weight = weight;
            this._date = today;
        }

        // Pushes this meal into global meals variable and stores it into localStorage.
        pushMeal () {
            meals.push(this);
            updateMeals();
        }

        get name() {return this._name;}

        get calories() {return this._calories;}

        get weight() {return this._weight;}

        get protein() {return this._protein;}

        get fat() {return this._fat;}

        get sugars() {return this._sugars;}

        get id() {return this._id;}

        setDate (date) {
            this._date = date;
        }

        setId (Id) {
            this._id = Id;
        }
    }

    /*
        Represents class containing all user stats values (nutrition values) and also '_id' and '_name' variables
        from it's parent class.
     */
    class Stats extends AbstractEntity {
        constructor() {
            super("Neznámý");
            this._basal = 0.01;
            this._calories = 0.0;
            this._protein_income = 0.0;
            this._fat_income = 0.0;
            this._sugars_income = 0.0;
            this.loadStats();
        }

        // Calculate user's total calories outcome from input values.
        calculateBasal (name, weight, height, age, sex, activity, goal) {
            this._name = name;
            this._weight = weight;
            this._height = height;
            this._age = age;
            this._sex = sex;
            this._activity = activity;
            this._goal = goal;
            let newBasal = 0.0;
            if (this._sex === "female") {
                newBasal = 655.0955 + (9.5634 * this._weight) + (1.8496* this._height) - (4.6756 * this._age);
            } else if (this._sex ==="male") {
                newBasal = 66.473 + (13.7516 * this._weight) + (5.0033 * this._height) - (6.755 * this._age);
            }
            this._basal = newBasal* this._activity * this._goal;
        }

        get basal() {
            return this._basal;
        }

        // Stores stats variable to localStorage.
        saveStats () {
            let saveObject = {
                name: this._name,
                basal: this.basal,
                calories: this._calories,
                protein: this._protein_income,
                fat: this._fat_income,
                sugars: this._sugars_income,
                date: today
            };
            localStorage.setItem("stats", JSON.stringify(saveObject));
        }

        // Loads stats variable from localStorage.
        loadStats () {
            let loadObject = localStorage.getItem("stats");
            if (loadObject === null) {
                this.saveStats();
                return;
            }
            let statsObject = JSON.parse(loadObject);
            if (statsObject.date !== today) {
                this._calories = 0.0;
                this._protein_income = 0.0;
                this._fat_income = 0.0;
                this._sugars_income = 0.0;
                this._basal = statsObject.basal;
                this._name = statsObject.name;
                return;
            }

            this._name = statsObject.name;
            this._basal = statsObject.basal;
            this._calories = statsObject.calories;
            this._protein_income = statsObject.protein;
            this._fat_income = statsObject.fat;
            this._sugars_income = statsObject.sugars;

            if (this._name === undefined || this._name === null) {this._name = "Neznámý"}
            if (this._basal === undefined || this._basal === null || this._basal < 0) {this._basal = 0.01;}
            if (this._calories === undefined || this._calories === null || this._calories < 0) {this._calories = 0.0;}
            if (this._protein_income === undefined || this._protein_income === null || this._protein_income < 0) {this._protein_income = 0.0;}
            if (this._fat_income === undefined || this._fat_income === null || this._fat_income < 0) {this._fat_income = 0.0;}
            if (this._sugars_income === undefined || this._sugars_income === null || this._sugars_income < 0) {this._sugars_income = 0.0;}
        }

        // Updates user panel with brief stats info.
        updateUserInfo () {
            this.loadStats();
            document.getElementById("user-name").innerText =
                "Uživatel: " + this._name + '\r' +
                "Výdej: "+this.basal.toFixed(0)+ " [kcal]" + '\r' +
                "Příjem: "+this._calories.toFixed(0) + " [kcal]";
        }

    }

    /*
        Represents class for rendering percentage donut charts via SVG path elements.
     */
    class SVGPieChart {
            constructor (svgElementId) {
                this._svg = document.querySelector(svgElementId);
                this._svgNs = "http://www.w3.org/2000/svg";
            }

            // Draws path element curved as a circle to create a chart (similar to donut chart).
            drawChart (percentage, color, customChart) {
                if (percentage === null) {percentage = 0}
                if (percentage>100) {percentage = 100}
                let angle = percentage * 3.6;

                let pathElement = document.createElementNS(this._svgNs, "path");
                pathElement.setAttributeNS(null,"d", this.setArc(100, 100, angle));
                pathElement.setAttributeNS(null,"stroke-width","50");
                pathElement.setAttributeNS(null,"stroke",color);
                pathElement.setAttributeNS(null,"fill","none");

                let textElement = document.createElementNS(this._svgNs, "text");
                textElement.setAttributeNS(null,"x","80");
                textElement.setAttributeNS(null,"y","100");
                textElement.setAttributeNS(null,"fill","black");
                textElement.setAttributeNS(null,"height","40");

                if (customChart) {textElement.textContent = percentage.toFixed(0) + " %"}

                this._svg.appendChild(pathElement);
                this._svg.appendChild(textElement);
            }

            // Returns arc attributes for a path element.
            setArc(x, y, angleTo){
                let start = this.getCartesianCoordinates(x, y, angleTo);
                let end = this.getCartesianCoordinates(x, y, 0);

                let arcFlag = 0;
                if (angleTo >= 180) {arcFlag = 1}

                return `M ${start.x} ${start.y} A 100 100 0 ${arcFlag} 0 ${end.x} ${end.y}`;
            }

            // Returns coordinates to specific angle from center of coordinate system.
            getCartesianCoordinates(centerX, centerY, angle) {
                let angleInRadians = (angle-90) * 3.14159 / 180.0;

                return {
                    x: centerX + (100 * Math.cos(angleInRadians)),
                    y: centerY + (100 * Math.sin(angleInRadians))
                };
            }

            clear() {
                this._svg.innerHTML = "";
            }
    }

    // Adding event listeners to button elements.

    /*
        Creates new Meal object, saves it into meals array and stores it to localStorage.
        Updates user stats, empties input values and redirects to state page.
     */
    meal_button.addEventListener("click", function (e) {
        e.preventDefault();
        let textElementsToValidate = ["meal-name-input"];
        let numberElementsToValidate = ["meal-calories-input","meal-protein-input","meal-fat-input",
            "meal-sugars-input","meal-weight-input"];
        if (!validate(numberElementsToValidate,textElementsToValidate)) {
            return
        }
        let newMeal = new Meal(
            document.getElementById("meal-name-input").value,
            document.getElementById("meal-calories-input").value,
            document.getElementById("meal-protein-input").value,
            document.getElementById("meal-fat-input").value,
            document.getElementById("meal-sugars-input").value,
            document.getElementById("meal-weight-input").value);
        newMeal.pushMeal();

        stats._calories += newMeal.calories * newMeal.weight / 100;
        stats._protein_income += newMeal.protein * newMeal.weight / 100;
        stats._fat_income += newMeal.fat * newMeal.weight / 100;
        stats._sugars_income += newMeal.sugars * newMeal.weight / 100;

        document.getElementById("meal-name-input").value = "";
        document.getElementById("meal-calories-input").value = "";
        document.getElementById("meal-protein-input").value = "";
        document.getElementById("meal-fat-input").value = "";
        document.getElementById("meal-sugars-input").value = "";
        document.getElementById("meal-weight-input").value = "";

        stats.saveStats();
        stats.updateUserInfo();
        window.location.hash = "#state";
    });

    /*
        Updates stats object, saves it to localStorage and redirects to state page.
     */
    basal_button.addEventListener("click", function (e) {
        e.preventDefault();
        let textElementsToValidate = ["name-input"];
        let numberElementsToValidate = ["weight-input","height-input","age-input"];
        if (!validate(numberElementsToValidate, textElementsToValidate)) {
            return
        }
        stats.calculateBasal(
            document.getElementById("name-input").value,
            document.getElementById("weight-input").value,
            document.getElementById("height-input").value,
            document.getElementById("age-input").value,
            document.querySelector('.sex:checked').value,
            document.querySelector('.activity:checked').value,
            document.querySelector('.goal:checked').value);
        stats.saveStats();
        stats.updateUserInfo();
        window.location.hash = "#state";
    });

    // Wipes out all stored localStorage data and redirects to home page.
    state_button.addEventListener("click", function (e) {
        e.preventDefault();
        localStorage.clear();
        stats = new Stats();
        stats.updateUserInfo();
        loadMeals();
        loadStateData();
        window.location.hash = "#home";
    });

    // Renders meals found by Nutritionix API (up to top 10 results).
    find_meal_button.addEventListener("click", function (e) {
        e.preventDefault();
        let textElementsToValidate = ["find-meal-input"];
        if (!validate([],textElementsToValidate)) {
            return
        }
        document.getElementById("find-meal-content-all").innerHTML = 'Výsledky hledání: ';
        getFoodArrayByName(document.getElementById("find-meal-input").value,"find-meal-content-all");
        document.getElementById("find-meal-input").innerText = "";
    });

    // Simple input validation

    // Validates number input on being non-negative, non-empty, number value. Eventually input turns red.
    function validateNumberInput(inputElementId) {
        let element = document.getElementById(inputElementId);
        if (element.value < 0 || element.value==="" || isNaN(element.value)) {
            element.classList.add("error");
            return false;
        } else if (element.classList.contains("error")) {
            element.classList.remove("error");
            return true;
        }
        return true;
    }

    // Validates text input on being non-empty value up to 50 chars long. Eventually input turns red.
    function validateTextInput(inputElementId) {
        let element = document.getElementById(inputElementId);
        if (element.value === "" || element.value.length>50) {
            element.classList.add("error");
            return false;
        } else if (element.classList.contains("error")) {
            element.classList.remove("error");
            return true;
        }
        return true;
    }

    // Validates text and number input arrays.
    function validate(numberInputs, textInputs) {
        let success = true;
            for (let id of numberInputs) {
                if (!validateNumberInput(id)) {
                    success = false;
                }
            }
            for (let tid of textInputs) {
                if (!validateTextInput(tid)) {
                    success = false;
                }
            }
        return success;
    }

    // Loads data from Nutrition-ix API by XML-HTTP-REQUEST + Promises interface (works only with internet connection).

    // Returns first ten meal element results from JSON object.
    function getFirstTenResults(json) {
        let elements = [];
        for (let i = 0; i < 10; i++) {
            elements.push(
                {
                    calories: json.hits[i].fields.nf_calories,
                    name:  json.hits[i].fields.item_name,
                    total_fat: json.hits[i].fields.nf_total_fat,
                    protein: json.hits[i].fields.nf_protein,
                    brand: json.hits[i].fields.brand_name,
                    sugars: json.hits[i].fields.nf_sugars,
                    quantity: json.hits[i].fields.nf_serving_weight_grams,
                    size: json.hits[i].fields.nf_serving_size_qty,
                    unit: json.hits[i].fields.nf_serving_size_unit
                }
            )
        }
        return elements;
    }

    // Returns new Promise filled with result of specified request to search specific meal by name  on Nutritionix API.
    function getFoodRequest(name) {
        return new Promise((resolve, reject) => {

            // Creates new XHR, opens with specified values for getting all needed nutrition values and sets request headers.
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "https://nutritionix-api.p.rapidapi.com/v1_1/search/"+name+"?fields=item_name%2Cnf_calories" +
                "%2Cnf_protein%2Cnf_total_fat%2Cnf_serving_size_qty%2Cnf_serving_size_unit%2Cbrand_name%2Cnf_sugars"+"%2C"+"nf_serving_weight_grams");
            xhr.setRequestHeader("x-rapidapi-host", "nutritionix-api.p.rapidapi.com");
            xhr.setRequestHeader("x-rapidapi-key", "62cc3c3be3mshcad3df20843842ap139b49jsndc900c4dfc3f");

            xhr.onload = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    const parsedJSONObject = JSON.parse(xhr.responseText);
                    resolve(parsedJSONObject);
                }
                else {
                    reject(Error(xhr.statusText));
                }
            };
            xhr.onerror = function() {
                reject(Error("Network Error"));
            };
            xhr.send();
        });
    }

    function errorLog(err) {
        console.log('Error Occurred :', err);
    }

    // Asynchronously renders getFirstTenResults function result as a meal elements.
    async function getFoodArrayByName(name, toAppendContentId) {
        document.getElementById(toAppendContentId).innerText = "Výsledky hledání (0 z 10):";
        await getFoodRequest(name)
            .then(response => {
                document.getElementById(toAppendContentId).innerText = "Výsledky hledání (10 z 10):";
                for (let element of getFirstTenResults(response)) {
                    if (element.quantity === null) {element.quantity = "Nespecifikováno"}
                    if (element.size === null) {element.size = "Nespecifikováno"}
                    if (element.unit === null) {element.unit = "Nespecifikováno"}
                    if (element.protein === null) {element.protein = "Nespecifikováno"}
                    if (element.total_fat === null) {element.total_fat = "Nespecifikováno"}
                    if (element.sugars === null) {element.sugars = "Nespecifikováno"}

                    let createdElement = document.createElement("label");
                    createdElement.classList.add("label-content");
                    createdElement.innerText = "Popis: "+element.name+" \r Výrobce: "+element.brand +"\r Porce: "+element.size+" "
                        +element.unit+", "+element.quantity  + " [g] \r Obsah v 1 porci: \r Kalorie: "+ element.calories + " kcal - Bílkoviny: "
                        +element.protein+ " g - Tuky: "+element.total_fat + " g - Cukry: "+element.sugars + " g  \r" ;

                    let createdButton = document.createElement("button");
                    createdButton.classList.add("content-button");
                    createdButton.innerText = "Zapsat";
                    createdElement.appendChild(createdButton);

                    createdElement.style.pointerEvents = "none";
                    createdButton.style.pointerEvents = "auto";

                    createdButton.addEventListener("click", function (e) {
                        e.preventDefault();
                        document.getElementById("meal-name-input").value = element.name;
                        if (element.calories === "Nespecifikováno" || element.quantity === "Nespecifikováno") {
                            document.getElementById("meal-calories-input").value = 0;
                        } else {document.getElementById("meal-calories-input").value = (100 * element.calories / element.quantity).toFixed(0)}
                        if (element.protein === "Nespecifikováno" || element.quantity === "Nespecifikováno") {
                            document.getElementById("meal-protein-input").value = 0;
                        } else {document.getElementById("meal-protein-input").value = (100 * element.protein / element.quantity).toFixed(0)}
                        if (element.total_fat === "Nespecifikováno" || element.quantity === "Nespecifikováno") {
                            document.getElementById("meal-fat-input").value = 0;
                        } else {document.getElementById("meal-fat-input").value = (100 * element.total_fat / element.quantity).toFixed(0)}
                        if (element.sugars === "Nespecifikováno" || element.quantity === "Nespecifikováno") {
                            document.getElementById("meal-sugars-input").value = 0;
                        } else { document.getElementById("meal-sugars-input").value = (100 * element.sugars / element.quantity).toFixed(0)}
                        if (element.quantity === "Nespecifikováno") {
                            document.getElementById("meal-weight-input").value = 0;
                        } else {document.getElementById("meal-weight-input").value = element.quantity}
                        window.location.hash = "#home";
                    });

                    document.getElementById(toAppendContentId).appendChild(createdElement);
                }
            })
            .catch(error => {
                errorLog(error);
            });
    }
</script>
</body>
</html>
